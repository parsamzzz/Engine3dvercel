<!doctype html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="utf-8" />
  <title>Sora2 â€“ Text / Image to Video</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body{font-family:Tahoma,system-ui;background:#0b1020;color:#e8ecf1;margin:0;padding:24px}
    h1{text-align:center;margin-bottom:20px}
    .tabs{display:flex;justify-content:center;gap:8px;margin-bottom:16px}
    .tab{flex:1;text-align:center;padding:10px;border-radius:10px;background:#1b223a;cursor:pointer}
    .tab.active{background:#445cff;font-weight:bold}
    .card{background:#11172b;border:1px solid #24304d;border-radius:16px;padding:16px;margin:auto;max-width:600px}
    label{display:block;margin:.25rem 0;font-size:.9rem}
    input[type="text"],select,input[type="file"]{
      width:100%;padding:8px;margin-bottom:12px;border-radius:6px;
      border:1px solid #24304d;background:#0b1020;color:#e8ecf1
    }
    button{padding:10px 20px;border:none;border-radius:8px;background:#445cff;color:white;font-weight:bold;cursor:pointer}
    #result{white-space:pre-wrap;background:#0b1020;border-radius:8px;padding:8px;margin-top:10px;font-size:.85rem;max-height:300px;overflow:auto}
    video{width:100%;border-radius:12px;margin-top:12px}
  </style>
</head>
<body>
  <h1>ğŸš€ ØªØ³Øª Sora2</h1>

  <!-- Tabs -->
  <div class="tabs">
    <div class="tab active" data-tab="text">Text-to-Video</div>
    <div class="tab" data-tab="image">Image-to-Video</div>
  </div>

  <!-- Form -->
  <div class="card">
    <form id="taskForm">
      <!-- Ù…Ù‚Ø¯Ø§Ø± Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ù…Ø¯Ù„ -->
      <input type="hidden" name="model" id="model" value="sora-2-text-to-video">

      <label>Ù¾Ø±ÙˆÙ…Ù¾Øª:</label>
      <input type="text" name="prompt" placeholder="Describe your videoâ€¦" required>

      <div id="imageUpload" style="display:none;">
        <label>ØªØµÙˆÛŒØ± ÙˆØ±ÙˆØ¯ÛŒ:</label>
        <input type="file" name="image" accept="image/*">
      </div>

      <label>Aspect Ratio:</label>
      <select name="aspect_ratio">
        <option value="">Default</option>
        <option value="landscape">Landscape (16:9)</option>
        <option value="portrait">Portrait (9:16)</option>
      </select>

      <label>Quality:</label>
      <select name="quality">
        <option value="">Default</option>
        <option value="standard">Standard</option>
        <option value="hd">HD</option>
      </select>

      <button type="submit">ğŸš€ Ø§Ø±Ø³Ø§Ù„ Ø¯Ø±Ø®ÙˆØ§Ø³Øª</button>
    </form>

    <h3>ğŸ“Š ÙˆØ¶Ø¹ÛŒØª</h3>
    <pre id="result">Ù…Ù†ØªØ¸Ø± Ø§Ø±Ø³Ø§Ù„...</pre>
    <video id="videoPlayer" controls style="display:none;"></video>
  </div>

  <script>
    const tabs = document.querySelectorAll('.tab');
    const modelInput = document.getElementById('model');
    const imageUpload = document.getElementById('imageUpload');
    const form = document.getElementById('taskForm');
    const resultBox = document.getElementById('result');
    const videoPlayer = document.getElementById('videoPlayer');

    // Ø³ÙˆÛŒÛŒÚ† ØªØ¨â€ŒÙ‡Ø§
    tabs.forEach(tab=>{
      tab.addEventListener('click',()=>{
        tabs.forEach(t=>t.classList.remove('active'));
        tab.classList.add('active');

        if(tab.dataset.tab === 'text'){
          modelInput.value = 'sora-2-text-to-video';
          imageUpload.style.display = 'none';
        }else{
          modelInput.value = 'sora-2-image-to-video';
          imageUpload.style.display = 'block';
        }
      });
    });

    // Ú†Ú© ÙˆØ¶Ø¹ÛŒØª ØªØ³Ú©
    async function checkStatus(taskId){
      try{
        const res = await fetch(`https://engine3dvercel.onrender.com/api/sora2/recordInfo/${taskId}`);
        const data = await res.json();
        resultBox.textContent = JSON.stringify(data,null,2);

        if(data?.data?.state === 'success'){
          const urls = JSON.parse(data.data.resultJson).resultUrls;
          if(urls && urls.length){
            videoPlayer.src = urls[0];
            videoPlayer.style.display = 'block';
          }
        }else if(data?.data?.state === 'fail'){
          resultBox.textContent += '\nâŒ Ø¹Ù…Ù„ÛŒØ§Øª Ù†Ø§Ù…ÙˆÙÙ‚ Ø´Ø¯.';
        }else{
          setTimeout(()=>checkStatus(taskId),5000);
        }
      }catch(err){
        resultBox.textContent = 'âŒ Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª ÙˆØ¶Ø¹ÛŒØª: ' + err.message;
      }
    }

    // Ø§Ø±Ø³Ø§Ù„ ÙØ±Ù…
    form.addEventListener('submit',async e=>{
      e.preventDefault();
      videoPlayer.style.display = 'none';
      resultBox.textContent = 'â³ Ø¯Ø± Ø­Ø§Ù„ Ø§Ø±Ø³Ø§Ù„...';

      const formData = new FormData(form);
      try{
        const res = await fetch('https://engine3dvercel.onrender.com/api/sora2/createTask',{
          method:'POST',
          body: formData
        });
        const data = await res.json();
        resultBox.textContent = JSON.stringify(data,null,2);

        if(data.taskId){
          resultBox.textContent += '\nâ³ Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ¶Ø¹ÛŒØª...';
          setTimeout(()=>checkStatus(data.taskId),3000);
        }
      }catch(err){
        resultBox.textContent = 'âŒ Ø®Ø·Ø§: ' + err.message;
      }
    });
  </script>
</body>
</html>
